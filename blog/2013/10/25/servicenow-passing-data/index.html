<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Security-Policy" content="connect-src 'self'">

    <meta name="description" content="">
    <meta name="author" content="Jason Butz">

    <title>ServiceNow - Passing Data</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" data-attr="shadow-page">
    <link href="/css/page.css" rel="stylesheet" data-attr="shadow-page">
    <link href="/css/highlight.css" rel="stylesheet" data-attr="shadow-page">
    <link href="/css/style.css" rel="stylesheet">
    
</head>

<body>
    <div id="layout" class="pure-g">
        <div class="sidebar pure-u-1 pure-u-md-1-4 pure-u-lg-1-5">
            <div class="header">
                <img class="pure-img-responsive rounded-circle" src="https://scontent-ort2-1.xx.fbcdn.net/v/t1.0-9/13256141_2930854828151_3836105531451032844_n.jpg?oh=bbb35a5506578767d23a6b49aa2a83eb&oe=588723A8">
                <h1 class="brand-title">Jason Butz</h1>
                <h2 class="brand-tagline">Sr. Software Engineer<br />@ <a href="http://www.genesys.com/" target="_blank">Genesys</a></h2>

                <nav class="pure-menu">
                    <ul class="pure-menu-list">
                        <li class="pure-menu-item"><a href="/" class="pure-menu-link">Home</a></li>
                        <li class="pure-menu-item"><a href="/work" class="pure-menu-link">My Work</a></li>
                        <li class="pure-menu-item"><a href="/contact" class="pure-menu-link">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div id="main" class="content pure-u-1 pure-u-md-3-4 pure-u-lg-4-5">            <div class="page-card">
                <div class="post-header">
                    <h1><a href="/blog/2013/10/25/servicenow-passing-data">ServiceNow - Passing Data</a> <small>October 24th 2013</small></h1>
                </div>                
                <p>At work we came across an interesting issue when dealing with ServiceNow this week. We are working on implimenting Incident and needed to be able to create a change or a request from the incident. The new record needed to have its <code>parent</code> field set to reference the inicident. Some of the original code does this for requests by redirecting the user to the Service Catalog and setting a parameter in the URL that is meant to will in a field on the form. Unfortunatly that doesn&#39;t work in our case. Our changes are generated by using a wizard, and our requests are done with a record producer. We figured out a way to work around the issue and pass the values to the wizard and record producer. I thought it was something people might like to see.</p>
<p>Here is what the <em>Create Request</em> UI action looks like:</p>
<pre><code class="lang-js"><span class="hljs-comment">// Update saves incidents before going to the catalog homepage</span>
current.update();
<span class="hljs-comment">// Build the URL</span>
<span class="hljs-keyword">var</span> url = <span class="hljs-string">"com.glideapp.servicecatalog_cat_item_view.do?sysparm_id=abcdef0123456789&amp;incident_sysid="</span>;
url += current.sys_id;
<span class="hljs-comment">// Redirect the user</span>
action.setRedirectURL(url);
</code></pre>
<p>What I am doing here is setting the URL for the record producer. Then I am adding a custom parameter on the end, <code>incident_sysid</code>, and setting it to the incident&#39;s <code>sys_id</code>. You can do the same thing for a wizard. Then on the first panel of the wizard, or on the record producer, you need to add a field to put the value into. I added the field and then used a UI Policy to hide the field. Then I created an onLoad Client Script that takes the parameter from the URL and fills in the form field. Here is the client script I am using with both the wizard and record producer.</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onLoad</span>(<span class="hljs-params"></span>)
</span>{
   <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">window</span>.location.href;
   <span class="hljs-keyword">var</span> match = url.match(<span class="hljs-regexp">/&amp;incident_sysid=([a-zA-Z0-9]+)/</span>);
   <span class="hljs-keyword">var</span> sysid = match[<span class="hljs-number">1</span>];
   g_form.setValue(<span class="hljs-string">'parent'</span>, sysid);
}
</code></pre>
<p>The script runs a regular expression against the current URL to pull out the <code>sys_id</code> and set it to the value of the field. Keep in mind that if you are using a wizard you will need to update the record producer at the end to set the value on the new record. If you are using just a record producer you can name the field the same thing in both the producer and the dictionary and it will automatically copy over.</p>

            </div>
            </div>
        </div>
    </div>
    <script src="/js/index.js"></script>
    
</body>

</html>