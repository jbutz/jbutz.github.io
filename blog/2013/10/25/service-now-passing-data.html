<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Jason Butz - ServiceNow - Passing Data</title>
	<meta name="viewport" content="width=device-width">

	<link rel="alternate" type="application/rss+xml" title="Blog Feed" href="http://www.jasonbutz.info/blog/atom.xml" />
	<link rel="alternate" type="application/rss+xml" title="Projects Feed" href="http://www.jasonbutz.info/project/atom.xml" />

	<!-- Foundation -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/css/normalize.min.css"/>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/css/foundation.min.css"/>
	<link rel="stylesheet" href="/assets/css/social_foundicons.css"/>

	<link rel="stylesheet" href="/assets/css/syntax.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css" />

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/vendor/custom.modernizr.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins.js"></script>
</head>
<body>
	<header>
		<div class="row">
			<div class="small-8 large-6 columns">
				<h1><a href="/">Jason Butz</a></h1>
			</div>
			<div class="small-4 large-6 columns">
				<nav class="contain-to-grid">
					<div class="top-bar">
						<ul class="title-area">
							<li class="name"><!-- Leave this empty --></li>
							<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
						</ul>
						<section class="top-bar-section">
							<ul class="right">
								<li class="active"><a href="/">Home</a></li>
								<li><a href="/projects.html">Projects</a></li>
								<li><a href="/blog">Blog</a></li>
								<li><a href="/contact.html">Contact Me</a></li>
							</ul>
						</section>
					</div>
				</nav>
			</div>
		</div>
	</header>

	<section id="mainContent">
		<div class="small-12 large-8 large-centered columns">
<div class="row">
	<div class="small-12 columns">
		<h2>ServiceNow - Passing Data <small>25 Oct 2013</small></h2>
	</div>
</div>
<div class="row">
	<div class="small-12 columns">
		<div class="post">
			<p>At work we came across an interesting issue when dealing with ServiceNow this week. We are working on implimenting Incident and needed to be able to create a change or a request from the incident. The new record needed to have its <code>parent</code> field set to reference the inicident. Some of the original code does this for requests by redirecting the user to the Service Catalog and setting a parameter in the URL that is meant to will in a field on the form. Unfortunatly that doesn’t work in our case. Our changes are generated by using a wizard, and our requests are done with a record producer. We figured out a way to work around the issue and pass the values to the wizard and record producer. I thought it was something people might like to see.</p>

<p>Here is what the <em>Create Request</em> UI action looks like:</p>

<div class="highlight"><pre><code class="javascript"><span class="c1">// Update saves incidents before going to the catalog homepage</span>
<span class="nx">current</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="c1">// Build the URL</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;com.glideapp.servicecatalog_cat_item_view.do?sysparm_id=abcdef0123456789&amp;incident_sysid=&quot;</span><span class="p">;</span>
<span class="nx">url</span> <span class="o">+=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">sys_id</span><span class="p">;</span>
<span class="c1">// Redirect the user</span>
<span class="nx">action</span><span class="p">.</span><span class="nx">setRedirectURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span></code></pre></div>

<p>What I am doing here is setting the URL for the record producer. Then I am adding a custom parameter on the end, <code>incident_sysid</code>, and setting it to the incident’s <code>sys_id</code>. You can do the same thing for a wizard. Then on the first panel of the wizard, or on the record producer, you need to add a field to put the value into. I added the field and then used a UI Policy to hide the field. Then I created an onLoad Client Script that takes the parameter from the URL and fills in the form field. Here is the client script I am using with both the wizard and record producer.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">onLoad</span><span class="p">()</span>
<span class="p">{</span>
   <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&amp;incident_sysid=([a-zA-Z0-9]+)/</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">sysid</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
   <span class="nx">g_form</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="nx">sysid</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>The script runs a regular expression against the current URL to pull out the <code>sys_id</code> and set it to the value of the field. Keep in mind that if you are using a wizard you will need to update the record producer at the end to set the value on the new record. If you are using just a record producer you can name the field the same thing in both the producer and the dictionary and it will automatically copy over.</p>

		</div>
	</div>
</div>

<div class="row">
	<div class="small-12 columns">
		<hr>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'jasonbutzblog'; // required: replace example with your forum shortname
			var disqus_identifier = '/blog/2013/10/25/service-now-passing-data';
			var disqus_title = 'ServiceNow - Passing Data';
			var disqus_url = 'http://www.jasonbutz.info/blog/2013/10/25/service-now-passing-data.html';

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>

		</div>
	</section>
	<footer>
		<div class="row">
			<div class="small-12 columns">
				<p>
					<small><a href="http://www.jasonbutz.info/blog/atom.xml" title="Blog RSS Feed"><i class="foundicon-rss">&nbsp;Blog RSS Feed</i></a></small>
					&nbsp;&nbsp;
					<small><a href="http://www.jasonbutz.info/project/atom.xml" title="Projects RSS Feed"><i class="foundicon-rss">&nbsp;Projects RSS Feed</i></a></small>
					<br />
					<small>Jason Butz &copy; 2012 - 2014</small><br>
				</p>
			</div>
		</div>
	</footer>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/foundation.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/foundation/foundation.topbar.min.js"></script>
	<script type="text/javascript">$(document).foundation();</script>
	<script type="text/javascript" src="/assets/js/site.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-45171709-1', 'jasonbutz.info');
		ga('send', 'pageview');
	</script>
	<!--[if !(lte IE 8)]><!--> 
	<script type="text/javascript"> 
	(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src=document.location.protocol+"//d1agz031tafz8n.cloudfront.net/thedaywefightback.js/widget.min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
	</script>
	<!--<![endif]-->
</body>
</html>