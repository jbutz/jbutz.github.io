<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Jason Butz - Blog</title>
	<meta name="viewport" content="width=device-width">

	<link rel="alternate" type="application/rss+xml" title="Blog Feed" href="http://www.jasonbutz.info/blog/atom.xml" />
	<link rel="alternate" type="application/rss+xml" title="Projects Feed" href="http://www.jasonbutz.info/project/atom.xml" />

	<!-- Foundation -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/css/normalize.min.css"/>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/css/foundation.min.css"/>
	<link rel="stylesheet" href="/assets/css/social_foundicons.css"/>

	<link rel="stylesheet" href="/assets/css/syntax.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css" />

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/vendor/custom.modernizr.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins.js"></script>
</head>
<body>
	<header>
		<div class="row">
			<div class="small-8 large-6 columns">
				<h1><a href="/">Jason Butz</a></h1>
			</div>
			<div class="small-4 large-6 columns">
				<nav class="contain-to-grid">
					<div class="top-bar">
						<ul class="title-area">
							<li class="name"><!-- Leave this empty --></li>
							<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
						</ul>
						<section class="top-bar-section">
							<ul class="right">
								<li class="active"><a href="/">Home</a></li>
								<li><a href="/projects.html">Projects</a></li>
								<li><a href="/blog">Blog</a></li>
								<li><a href="/contact.html">Contact Me</a></li>
							</ul>
						</section>
					</div>
				</nav>
			</div>
		</div>
	</header>

	<section id="mainContent">
		<div class="small-12 large-8 large-centered columns">
<div class="row">
	<div class="small-12 columns">
		<h2>Blog</h2>
	</div>
</div>
 
<article>
<div class="row">
	<div class="small-12 columns">
		<h4><a href="/blog/2013/04/12/ruby-on-rails-exceptions.html">Ruby on Rails Exceptions</a> <small>12 Apr 2013</small></h4>
	</div>
</div>
<div class="row">
	<div class="small-12 columns">
		<p>I&#8217;ve been learning Ruby and Ruby on Rails recently, and I was working on an application today that gave me some trouble in one particular area. The application is a simple application to allow IT to post the status of different systems so people can be aware of any issues. There are three models involved:</p>

<ul>
<li>Services</li>

<li>Statuses</li>

<li>Events</li>
</ul>

<p>An event references both a service and a status. I needed to be able to ensure a status being deleted wasn&#8217;t referenced by any events. The callback and the database query were easy, but I was having issues when it came to showing an error as to why the status wasn&#8217;t deleted. After a bit of Googling I found that exceptions seems to be the best way to do this. That was good to know, but I still had to figure out how to use them for this case. I had trouble finding any good example of an exception being used, so I figure I ought to post what I came up with.</p>

<p><em>status_controller.rb</em></p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>StatusesController</span> <span class='o'>&lt;</span> <span class='no'>ApplicationController</span>
<span class='o'>.</span><span class='n'>.</span><span class='o'>.</span>
  <span class='k'>def</span> <span class='nf'>destroy</span>
    <span class='vi'>@status</span> <span class='o'>=</span> <span class='no'>Status</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:id</span><span class='o'>]</span><span class='p'>)</span>
    <span class='k'>begin</span>
      <span class='vi'>@status</span><span class='o'>.</span><span class='n'>destroy</span>
    <span class='k'>rescue</span> <span class='no'>Exception</span> <span class='o'>=&gt;</span> <span class='n'>e</span>
      <span class='n'>flash</span><span class='o'>[</span><span class='ss'>:error</span><span class='o'>]</span> <span class='o'>=</span> <span class='n'>e</span><span class='o'>.</span><span class='n'>message</span>
      <span class='n'>redirect_to</span> <span class='n'>statuses_url</span>
      <span class='k'>return</span>
    <span class='k'>end</span>

    <span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>html</span> <span class='p'>{</span> <span class='n'>redirect_to</span> <span class='n'>statuses_url</span> <span class='p'>}</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>json</span> <span class='p'>{</span> <span class='n'>head</span> <span class='ss'>:no_content</span> <span class='p'>}</span>
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p><em>status.rb</em></p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Status</span> <span class='o'>&lt;</span> <span class='no'>ActiveRecord</span><span class='o'>::</span><span class='no'>Base</span>
<span class='o'>.</span><span class='n'>.</span><span class='o'>.</span>
  <span class='n'>before_destroy</span> <span class='ss'>:check_existing_events</span>

  <span class='kp'>private</span>
<span class='o'>.</span><span class='n'>.</span><span class='o'>.</span>
  <span class='k'>def</span> <span class='nf'>check_existing_events</span>
    <span class='k'>raise</span> <span class='no'>Exception</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='s2'>&quot;Events exist that use that status.&quot;</span><span class='p'>)</span> <span class='k'>unless</span> <span class='no'>Event</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:status_id</span> <span class='o'>=&gt;</span> <span class='nb'>self</span><span class='o'>.</span><span class='n'>id</span><span class='p'>)</span><span class='o'>.</span><span class='n'>count</span> <span class='o'>==</span> <span class='mi'>0</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
	</div>
</div>
</article>
<hr>


<div class="row">
	<div class="small-4 small-centered columns">
		<div style="text-align: center">
		<ul class="button-group" style="display: inline-block">
			
				
			  		<li><a href="/blog/page2" class="small button">&larr;</a></li>
				
			

			
				<li><a href="#" class="small button disabled">&rarr;</a></li>
			
		</ul>
	</div>
	</div>
</div>




		</div>
	</section>
	<footer>
		<div class="row">
			<div class="small-12 columns">
				<p>
					<small><a href="http://www.jasonbutz.info/blog/atom.xml" title="Blog RSS Feed"><i class="foundicon-rss">&nbsp;Blog RSS Feed</i></a></small>
					&nbsp;&nbsp;
					<small><a href="http://www.jasonbutz.info/project/atom.xml" title="Projects RSS Feed"><i class="foundicon-rss">&nbsp;Projects RSS Feed</i></a></small>
					<br />
					<small>Jason Butz &copy; 2012 - 2014</small><br>
				</p>
			</div>
		</div>
	</footer>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/foundation.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/4.1.6/js/foundation/foundation.topbar.min.js"></script>
	<script type="text/javascript">$(document).foundation();</script>
	<script type="text/javascript" src="/assets/js/site.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-45171709-1', 'jasonbutz.info');
		ga('send', 'pageview');
	</script>
</body>
</html>